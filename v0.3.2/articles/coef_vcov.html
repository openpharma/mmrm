<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mmrm">
<title>Coefficients Covariance Matrix Adjustment • mmrm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Coefficients Covariance Matrix Adjustment">
<meta property="og:description" content="mmrm">
<meta property="og:image" content="https://openpharma.github.io/mmrm/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125641273-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mmrm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Introduction</h6>
    <a class="dropdown-item" href="../articles/introduction.html">Package Introduction</a>
    <a class="dropdown-item" href="../articles/methodological_introduction.html">Mixed Models for Repeated Measures</a>
    <a class="dropdown-item" href="../articles/mmrm_review_methods.html">Comparison with other software</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Covariance Structures</h6>
    <a class="dropdown-item" href="../articles/covariance.html">Covariance Structures</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Degrees of Freedom</h6>
    <a class="dropdown-item" href="../articles/between_within.html">Between-Within</a>
    <a class="dropdown-item" href="../articles/kenward.html">Kenward-Roger</a>
    <a class="dropdown-item" href="../articles/satterthwaite.html">Satterthwaite</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Coefficient Covariance</h6>
    <a class="dropdown-item" href="../articles/coef_vcov.html">Coefficients Covariance Matrix Adjustment</a>
    <a class="dropdown-item" href="../articles/empirical_wls.html">Details of Weighted Least Square Empirical Covariance</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Algorithm Details</h6>
    <a class="dropdown-item" href="../articles/algorithm.html">Model Fitting Algorithm</a>
    <a class="dropdown-item" href="../articles/predict.html">Prediction and Simulation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Developers</h6>
    <a class="dropdown-item" href="../articles/package_structure.html">Package Structure</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.13">v0.3.13</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.12">v0.3.12</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.11">v0.3.11</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.10">v0.3.10</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.7">v0.3.7</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.6">v0.3.6</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.5">v0.3.5</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.4">v0.3.4</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.3">v0.3.3</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.2">v0.3.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.1">v0.3.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.0">v0.3.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.2.2">v0.2.2</a> </div></li>
<!-- end dropdown for versions -->
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../coverage-report/">Coverage report</a>
    <a class="dropdown-item" href="../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/openpharma/mmrm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Coefficients Covariance Matrix Adjustment</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/mmrm/blob/HEAD/vignettes/coef_vcov.Rmd" class="external-link"><code>vignettes/coef_vcov.Rmd</code></a></small>
      <div class="d-none name"><code>coef_vcov.Rmd</code></div>
    </div>

    
    
<p>Here we describe the variance-covariance matrix adjustment of
coefficients.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>To estimate the covariance matrix of coefficients, there are many
ways. In <code>mmrm</code> package, we implemented asymptotic,
empirical, Jackknife and Kenward-Roger methods. For simplicity, the
following derivation are all for unweighted mmrm. For weighted mmrm, we
can follow the <a href="https://openpharma.github.io/mmrm/main/articles/algorithm.html#weighted-least-squares-estimator">details
of weighted least square estimator</a>.</p>
<div class="section level3">
<h3 id="asymptotic-covariance">Asymptotic Covariance<a class="anchor" aria-label="anchor" href="#asymptotic-covariance"></a>
</h3>
<p>Asymptotic covariance are derived based on the estimate of <span class="math inline">\(\beta\)</span>.</p>
<p>Following the definition in <a href="algorithm.html#linear-model">details in model fitting</a>, we
have</p>
<p><span class="math display">\[
  \hat\beta = (X^\top W X)^{-1} X^\top W Y
\]</span></p>
<p><span class="math display">\[
  cov(\hat\beta) = (X^\top W X)^{-1} X^\top W cov(\epsilon) W X (X^\top
W X)^{-1} = (X^\top W X)^{-1}
\]</span></p>
<p>Where <span class="math inline">\(W\)</span> is the block diagonal
matrix of inverse of covariance matrix of <span class="math inline">\(\epsilon\)</span>.</p>
</div>
<div class="section level3">
<h3 id="empirical-covariance">Empirical Covariance<a class="anchor" aria-label="anchor" href="#empirical-covariance"></a>
</h3>
<p>Empirical covariance, also known as the robust sandwich estimator, or
“CR0”, is derived by replacing the covariance matrix of <span class="math inline">\(\epsilon\)</span> by observed covariance
matrix.</p>
<p><span class="math display">\[
  cov(\hat\beta) = (X^\top W X)^{-1}(\sum_{i}{X_i^\top W_i
\hat\epsilon_i\hat\epsilon_i^\top W_i X_i})(X^\top W X)^{-1}
  = (X^\top W X)^{-1}(\sum_{i}{X_i^\top L_{i} L_{i}^\top
\hat\epsilon_i\hat\epsilon_i^\top L_{i} L_{i}^\top X_i})(X^\top W
X)^{-1}
\]</span></p>
<p>Where <span class="math inline">\(W_i\)</span> is the block diagonal
part for subject <span class="math inline">\(i\)</span> of <span class="math inline">\(W\)</span> matrix, <span class="math inline">\(\hat\epsilon_i\)</span> is the observed residuals
for subject i, <span class="math inline">\(L_i\)</span> is the Cholesky
factor of <span class="math inline">\(\Sigma_i^{-1}\)</span> (<span class="math inline">\(W_i = L_i L_i^\top\)</span>).</p>
<p>See the detailed explanation of these formulas in the <a href="empirical_wls.html">Weighted Least Square Empirical Covariance</a>
vignette.</p>
</div>
<div class="section level3">
<h3 id="jackknife-covariance">Jackknife Covariance<a class="anchor" aria-label="anchor" href="#jackknife-covariance"></a>
</h3>
<p>Jackknife method in <code>mmrm</code> is the “leave-one-cluster-out”
method. It is also known as “CR3”. Following <span class="citation">McCaffrey and Bell (2003)</span>, we have</p>
<p><span class="math display">\[
  cov(\hat\beta) = (X^\top W X)^{-1}(\sum_{i}{X_i^\top L_{i} (I_{i} -
H_{ii})^{-1} L_{i}^\top \hat\epsilon_i\hat\epsilon_i^\top L_{i} (I_{i} -
H_{ii})^{-1} L_{i}^\top X_i})(X^\top W X)^{-1}
\]</span></p>
<p>where</p>
<p><span class="math display">\[H_{ii} = X_i(X^\top
X)^{-1}X_i^\top\]</span></p>
<p>Please note that in the paper there is an additional scale parameter
<span class="math inline">\(\frac{n-1}{n}\)</span> where <span class="math inline">\(n\)</span> is the number of subjects, here we do
not include this parameter.</p>
</div>
<div class="section level3">
<h3 id="bias-reduced-covariance">Bias-Reduced Covariance<a class="anchor" aria-label="anchor" href="#bias-reduced-covariance"></a>
</h3>
<p>Bias-reduced method, also known as “CR2”, provides unbiased under
correct working model. Following <span class="citation">McCaffrey and
Bell (2003)</span>, we have <span class="math display">\[
  cov(\hat\beta) = (X^\top W X)^{-1}(\sum_{i}{X_i^\top L_{i} (I_{i} -
H_{ii})^{-1/2} L_{i}^\top \hat\epsilon_i\hat\epsilon_i^\top L_{i} (I_{i}
- H_{ii})^{-1} L_{i}^\top X_i})(X^\top W X)^{-1}
\]</span></p>
<p>where</p>
<p><span class="math display">\[H_{ii} = X_i(X^\top
X)^{-1}X_i^\top\]</span></p>
</div>
<div class="section level3">
<h3 id="kenward-roger-covariance">Kenward-Roger Covariance<a class="anchor" aria-label="anchor" href="#kenward-roger-covariance"></a>
</h3>
<p>Kenward-Roger covariance is an adjusted covariance matrix for small
sample size. Details can be found in <a href="kenward.html#mathematical-details-of-kenward-roger-method">Kenward-Roger</a></p>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-mccaffrey2003bias" class="csl-entry">
McCaffrey, Daniel F, and Robert M Bell. 2003. <span>“Bias Reduction in
Standard Errors for Linear Regression with Multi-Stage Samples.”</span>
<em>Quality Control and Applied Statistics</em> 48 (6): 677–82.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Daniel Sabanes Bove, Julia Dedic, Doug Kelkhoff, Kevin Kunzmann, Brian Matthew Lang, Liming Li, Christian Stock, Ya Wang, Dan James, Jonathan Sidi, Daniel Leibovitz, Daniel D. Sjoberg, Boehringer Ingelheim Ltd., Gilead Sciences, Inc., F. Hoffmann-La Roche AG, Merck Sharp &amp; Dohme, Inc., AstraZeneca plc.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
