<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mmrm">
<title>Covariance Structures in `mmrm` • mmrm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Covariance Structures in `mmrm`">
<meta property="og:description" content="mmrm">
<meta property="og:image" content="https://openpharma.github.io/mmrm/main/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125641273-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mmrm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2.9006</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/algorithm.html">Details of the Model Fitting in `mmrm`</a>
    <a class="dropdown-item" href="../articles/coef_vcov.html">Coefficients Covariance Matrix Adjustment in `mmrm`</a>
    <a class="dropdown-item" href="../articles/covariance.html">Covariance Structures in `mmrm`</a>
    <a class="dropdown-item" href="../articles/introduction.html">Introduction to `mmrm`</a>
    <a class="dropdown-item" href="../articles/kenward.html">Details of the Kenward-Roger calculations</a>
    <a class="dropdown-item" href="../articles/methodological_introduction.html">What are MMRMs? A brief introduction</a>
    <a class="dropdown-item" href="../articles/package_structure.html">Package Structure</a>
    <a class="dropdown-item" href="../articles/satterthwaite.html">Details of the Satterthwaite calculations</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/openpharma/mmrm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Covariance Structures in `mmrm`</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/mmrm/blob/HEAD/vignettes/covariance.Rmd" class="external-link"><code>vignettes/covariance.Rmd</code></a></small>
      <div class="d-none name"><code>covariance.Rmd</code></div>
    </div>

    
    
<p>Here we describe the covariance structures which are currently
available in <code>mmrm</code>.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We use some concepts throughout the different covariance structures
and introduce these here.</p>
<div class="section level3">
<h3 id="covariance-and-correlation-matrices">Covariance and Correlation Matrices<a class="anchor" aria-label="anchor" href="#covariance-and-correlation-matrices"></a>
</h3>
<p>The symmetric and positive definite covariance matrix <span class="math display">\[
\Sigma = \begin{pmatrix}
\sigma_1^2 &amp; \sigma_{12} &amp; \dots &amp; \dots &amp; \sigma_{1m}
\\
\sigma_{21} &amp; \sigma_2^2 &amp; \sigma_{23} &amp; \dots &amp;
\sigma_{2m}\\
\vdots &amp; &amp; \ddots &amp; &amp; \vdots \\
\vdots &amp; &amp; &amp; \ddots &amp; \vdots \\
\sigma_{m1} &amp; \dots &amp; \dots &amp; \sigma_{m,m-1} &amp;
\sigma_m^2
\end{pmatrix}
\]</span> is parametrized by a vector of variance parameters <span class="math inline">\(\theta = (\theta_1, \dotsc,
\theta_k)^\top\)</span>. The meaning and the number (<span class="math inline">\(k\)</span>) of variance parameters is different
for each covariance structure.</p>
<p>In many covariance structures we use the decomposition <span class="math display">\[
\Sigma = DPD
\]</span> where the diagonal standard deviation matrix is <span class="math display">\[
D = \begin{pmatrix}
\sigma_1 &amp; 0 &amp; \cdots &amp; &amp; 0 \\
0 &amp; \sigma_2 &amp; 0 &amp; \cdots &amp; 0 \\
\vdots &amp; &amp; \ddots &amp; \ddots &amp; \vdots \\
&amp;  &amp; &amp; \sigma_{m-1} &amp; 0 \\
0 &amp; \cdots &amp; &amp; 0 &amp; \sigma_m
\end{pmatrix}
\]</span> with entries <span class="math inline">\(\sigma_i &gt;
0\)</span>, and the symmetric correlation matrix <span class="math inline">\(P\)</span> is <span class="math display">\[
P = \begin{pmatrix}
  1 &amp; \rho_{12}   &amp; \rho_{13} &amp; \cdots &amp; \cdots &amp;
\rho_{1,m-1} \\
  \rho_{12} &amp; 1      &amp; \rho_{23} &amp; \ddots &amp;        &amp;
\vdots \\
  \rho_{13} &amp; \rho_{23}      &amp; \ddots &amp; \ddots &amp; \ddots
&amp; \vdots \\
\vdots &amp; \ddots &amp; \ddots &amp; \ddots &amp; \rho_{m-2,m-1} &amp;
\rho_{m-2,m} \\
\vdots &amp;        &amp; \ddots &amp; \rho_{m-2,m-1}    &amp;
1    &amp; \rho_{m-1,m} \\
\rho_{1, m-1} &amp; \cdots &amp; \cdots &amp; \rho_{m-2,m} &amp;
\rho_{m-1,m}    &amp; 1
\end{pmatrix}
\]</span> with entries <span class="math inline">\(\rho_{ij} \in (-1,
1)\)</span>. Since these covariance structures assume different
variances for each time point they are called “heterogeneous” covariance
structures. Assuming a constant <span class="math inline">\(\sigma =
\sigma_1 = \dotsb = \sigma_m\)</span> gives a “homogeneous” covariance
structure instead.</p>
</div>
<div class="section level3">
<h3 id="transformation-to-variance-parameters">Transformation to Variance Parameters<a class="anchor" aria-label="anchor" href="#transformation-to-variance-parameters"></a>
</h3>
<p>For standard deviation parameters <span class="math inline">\(\sigma\)</span> we use the natural logarithm <span class="math inline">\(\log(\sigma)\)</span> to map them to <span class="math inline">\(\mathbb{R}\)</span>. For correlation parameters
<span class="math inline">\(\rho\)</span> we consistently use the
transformation <span class="math display">\[
\theta = f(\rho) = \mathop{\mathrm{sign}}(\rho) \sqrt{\frac{\rho^2}{1 -
\rho^2}}
\]</span> which maps the correlation parameter to <span class="math inline">\(\theta \in \mathbb{R}\)</span>. It has the inverse
<span class="math display">\[
\rho = f^{-1}(\theta) = \frac{\theta}{\sqrt{1 + \theta^2}}.
\]</span> This is important because the resulting variance parameters
<span class="math inline">\(\theta\)</span> can be optimized without
constraints over the whole of <span class="math inline">\(\mathbb{R}\)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="covariance-structures">Covariance Structures<a class="anchor" aria-label="anchor" href="#covariance-structures"></a>
</h2>
<div class="section level3">
<h3 id="unstructured-us">Unstructured (<code>us</code>)<a class="anchor" aria-label="anchor" href="#unstructured-us"></a>
</h3>
<p>Any covariance matrix can be represented by this saturated
correlation structure. Here <span class="math inline">\(k = m (m+1) /
2\)</span>. See the <a href="algorithm.html">algorithm vignette</a> for
details.</p>
</div>
<div class="section level3">
<h3 id="homogeneous-ad-and-heterogeneous-ante-dependence-adh">Homogeneous (<code>ad</code>) and Heterogeneous Ante-dependence
(<code>adh</code>)<a class="anchor" aria-label="anchor" href="#homogeneous-ad-and-heterogeneous-ante-dependence-adh"></a>
</h3>
<p>The ante-dependence correlation structure <span class="citation">(Gabriel 1962)</span> is useful for balanced designs
where the observations are not necessarily equally spaced in time. Here
we use an order one ante-dependence model, where the correlation matrix
<span class="math inline">\(P\)</span> has elements <span class="math display">\[
\rho_{ij} = \prod_{k=i}^{j-1} \rho_k.
\]</span> So we have correlation parameters <span class="math inline">\(\rho_k\)</span>, <span class="math inline">\(k =
1, \dotsc, m-1\)</span>.</p>
<p>We use a heterogeneous covariance structure to allow for different
within subject variances. So here we can identify <span class="math display">\[
\theta = (\log(\sigma_1), \dotsc, \log(\sigma_m), f(\rho_1), \dotsc,
f(\rho_{m-1}))
\]</span> and we have in total <span class="math inline">\(2m -
1\)</span> variance parameters. Assuming a constant variance yields a
homogeneous ante-dependence covariance structure with total <span class="math inline">\(m\)</span> variance parameters.</p>
<p>Note our naming convention for the homogeneous and heterogeneous
covariance structures that a suffix <code>h</code> is used to denote the
heterogeneous version, e.g, <code>ad</code> for homogeneous and
<code>adh</code> for heterogeneous ante-dependence. This is different
from the name used in SAS for ante-dependence covariance structure,
where <code>ANTE(1)</code> refers to heterogeneous ante-dependence
covariance structure and a homogeneous version is not provided in
SAS.</p>
</div>
<div class="section level3">
<h3 id="homogeneous-toep-and-heterogeneous-toeplitz-toeph">Homogeneous (<code>toep</code>) and Heterogeneous Toeplitz
(<code>toeph</code>)<a class="anchor" aria-label="anchor" href="#homogeneous-toep-and-heterogeneous-toeplitz-toeph"></a>
</h3>
<p>Toeplitz matrices <span class="citation">(Toeplitz 1911)</span> are
diagonal-constant matrices. Here we can model the correlation matrix as
a Toeplitz matrix: <span class="math display">\[
P = \begin{pmatrix}
  1 &amp; \rho_1   &amp; \rho_2 &amp; \cdots &amp; \cdots &amp;
\rho_{m-1} \\
  \rho_1 &amp; 1      &amp; \rho_1 &amp; \ddots &amp;        &amp;
\vdots \\
  \rho_2 &amp; \rho_1      &amp; \ddots &amp; \ddots &amp; \ddots &amp;
\vdots \\
\vdots &amp; \ddots &amp; \ddots &amp; \ddots &amp; \rho_1 &amp; \rho_2
\\
\vdots &amp;        &amp; \ddots &amp; \rho_1    &amp; 1    &amp; \rho_1
\\
\rho_{m-1} &amp; \cdots &amp; \cdots &amp; \rho_2    &amp;
\rho_1    &amp; 1
\end{pmatrix}
\]</span> This means that the correlation between two time points only
depends on the distance between them, i.e. <span class="math display">\[
\rho_{ij} = \rho_{\left\vert i - j\right\vert}
\]</span> and we have correlation parameters <span class="math inline">\(\rho_k\)</span>, <span class="math inline">\(k =
1, \dotsc, m-1\)</span>.</p>
<p>We use a heterogeneous covariance structure to allow for different
within subject variances. So here we can identify <span class="math display">\[
\theta = (\log(\sigma_1), \dotsc, \log(\sigma_m), f(\rho_1), \dotsc,
f(\rho_{m-1}))
\]</span> and we have in total <span class="math inline">\(2m -
1\)</span> variance parameters. This is similar to the heterogeneous
ante-dependence structure, but the correlation parameters are used
differently in the construction of <span class="math inline">\(P\)</span>. Assuming a constant variance yields a
homogeneous Toeplitz covariance structure with total <span class="math inline">\(m\)</span> variance parameters.</p>
</div>
<div class="section level3">
<h3 id="homogeneous-ar1-and-heterogeneous-ar1h-autoregressive">Homogeneous (<code>ar1</code>) and Heterogeneous (<code>ar1h</code>)
Autoregressive<a class="anchor" aria-label="anchor" href="#homogeneous-ar1-and-heterogeneous-ar1h-autoregressive"></a>
</h3>
<p>The autoregressive covariance structure can be motivated by the
corresponding state-space equation <span class="math display">\[
y_{it} = \varphi y_{i,t-1} + \varepsilon_t
\]</span> where the white noise <span class="math inline">\(\varepsilon_t\)</span> has a normal distribution
with mean zero and a constant variance. It can be shown that this gives
correlations <span class="math display">\[
\rho_{ij} = \rho^{\left\vert i - j\right\vert}.
\]</span> where <span class="math inline">\(\rho\)</span> is related to
<span class="math inline">\(\varphi\)</span> and the variance and is the
single correlation parameter here.</p>
<p>Assuming a constant variance in the state-space equation yields a
homogeneous autoregressive covariance structure with total only <span class="math inline">\(k=2\)</span> variance parameters, otherwise we
obtain the heterogeneous autoregressive covariance structure with <span class="math inline">\(k = m + 1\)</span> variance parameters.</p>
</div>
<div class="section level3">
<h3 id="homogeneous-cs-and-heterogeneous-csh-compound-symmetry">Homogeneous (<code>cs</code>) and Heterogeneous (<code>csh</code>)
Compound Symmetry<a class="anchor" aria-label="anchor" href="#homogeneous-cs-and-heterogeneous-csh-compound-symmetry"></a>
</h3>
<p>The compound symmetry covariance structures assume a constant
correlation between different time points: <span class="math display">\[
\rho_{ij} = \rho
\]</span> where <span class="math inline">\(\rho\)</span> is the single
correlation parameter here.</p>
<p>Assuming a constant variance in the state-space equation yields a
homogeneous compound symmetry covariance structure with total only <span class="math inline">\(k=2\)</span> variance parameters, otherwise we
obtain the heterogeneous compound symmetry covariance structure with
<span class="math inline">\(k = m + 1\)</span> variance parameters.</p>
</div>
</div>
<div class="section level2">
<h2 id="spatial-covariance-structure">Spatial Covariance Structure<a class="anchor" aria-label="anchor" href="#spatial-covariance-structure"></a>
</h2>
<p>Spatial covariance structures, unlike other covariance structures,
does not require that the timepoints are consistent between subjects.
Instead, as long as the distance between visits can be quantified in
terms of time and/or other coordinates, the spatial covariance structure
can be applied. Euclidean distance is the most common case. For each
subject, the covariance structure can be different. Only homogeneous
structures are allowed (i.e. a common variance is used).</p>
<p>Please note that while printing the summary of an <code>mmrm</code>
fit, the covariance displayed is a 2 * 2 square matrix. As the distance
will be used to derive the corresponding element in that matrix, unit
distance is used here. The distance matrix is</p>
<p><span class="math display">\[
    \begin{pmatrix}
    0 &amp; 1\\
    1 &amp; 0\\
    \end{pmatrix}
\]</span></p>
<div class="section level3">
<h3 id="spatial-exponential">Spatial exponential<a class="anchor" aria-label="anchor" href="#spatial-exponential"></a>
</h3>
<p>For spatial exponential, the covariance structure is defined as
follows:</p>
<p><span class="math display">\[
  \rho_{ij} = \rho^{d_{ij}}
\]</span></p>
<p>where <span class="math inline">\(d_{ij}\)</span> is the distance
between time point <span class="math inline">\(i\)</span> and time point
<span class="math inline">\(j\)</span>,</p>
<p>A total number of parameters <span class="math inline">\(k =
2\)</span> is needed:</p>
<p>The parameterization for <span class="math inline">\(\theta\)</span>
is a little different from previous examples. In previous examples,
<span class="math inline">\(\rho\)</span> can take values from -1 to 1,
but here we need to restrict <span class="math inline">\(\rho\)</span>
to (0, 1). Hence we have the following parametrization form.</p>
<p><span class="math display">\[
  \theta = (\log(\sigma), \mathop{\mathrm{logit}}(\rho))
\]</span></p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Gabriel1962" class="csl-entry">
Gabriel, K. R. 1962. <span>“<span class="nocase">Ante-dependence
Analysis of an Ordered Set of Variables</span>.”</span> <em>The Annals
of Mathematical Statistics</em> 33 (1): 201–12. <a href="https://doi.org/10.1214/aoms/1177704724" class="external-link">https://doi.org/10.1214/aoms/1177704724</a>.
</div>
<div id="ref-Toeplitz1911" class="csl-entry">
Toeplitz, Otto. 1911. <span>“Zur <span>Theorie</span> Der Quadratischen
Und Bilinearen <span>Formen</span> von Unendlichvielen
<span>Veränderlichen</span>.”</span> <em>Mathematische Annalen</em> 70
(3): 351–76. <a href="https://doi.org/10.1007/BF01564502" class="external-link">https://doi.org/10.1007/BF01564502</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Daniel Sabanes Bove, Julia Dedic, Doug Kelkhoff, Kevin Kunzmann, Brian Matthew Lang, Liming Li, Christian Stock, Ya Wang, Dan James, Boehringer Ingelheim Ltd., Gilead Sciences, Inc., F. Hoffmann-La Roche AG, Merck Sharp &amp; Dohme, Inc., AstraZeneca plc.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
