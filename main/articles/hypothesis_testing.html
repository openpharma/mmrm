<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Details of Hypothesis Testing • mmrm</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Details of Hypothesis Testing">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125641273-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mmrm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.15.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Package Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/methodological_introduction.html">Mixed Models for Repeated Measures</a></li>
    <li><a class="dropdown-item" href="../articles/mmrm_review_methods.html">Comparison with other software</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Covariance Structures</h6></li>
    <li><a class="dropdown-item" href="../articles/covariance.html">Covariance Structures</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Degrees of Freedom and Testing</h6></li>
    <li><a class="dropdown-item" href="../articles/hypothesis_testing.html">Details of Hypothesis Testing</a></li>
    <li><a class="dropdown-item" href="../articles/between_within.html">Between-Within</a></li>
    <li><a class="dropdown-item" href="../articles/kenward.html">Kenward-Roger</a></li>
    <li><a class="dropdown-item" href="../articles/satterthwaite.html">Satterthwaite</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Coefficient Covariance</h6></li>
    <li><a class="dropdown-item" href="../articles/coef_vcov.html">Coefficients Covariance Matrix Adjustment</a></li>
    <li><a class="dropdown-item" href="../articles/empirical_wls.html">Details of Weighted Least Square Empirical Covariance</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Algorithm Details</h6></li>
    <li><a class="dropdown-item" href="../articles/algorithm.html">Model Fitting Algorithm</a></li>
    <li><a class="dropdown-item" href="../articles/predict.html">Prediction and Simulation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Developers</h6></li>
    <li><a class="dropdown-item" href="../articles/package_structure.html">Package Structure</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage-report/">Coverage report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report/">Unit test report</a></li>
  </ul>
</li>
      <div><li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.15">v0.3.15</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.14">v0.3.14</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.13">v0.3.13</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.12">v0.3.12</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.11">v0.3.11</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.10">v0.3.10</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.7">v0.3.7</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.6">v0.3.6</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.5">v0.3.5</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.4">v0.3.4</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.3">v0.3.3</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.2">v0.3.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.1">v0.3.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.3.0">v0.3.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.2.2">v0.2.2</a>
</div>
</li></div>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/mmrm"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Details of Hypothesis Testing</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/mmrm/blob/main/vignettes/hypothesis_testing.Rmd" class="external-link"><code>vignettes/hypothesis_testing.Rmd</code></a></small>
      <div class="d-none name"><code>hypothesis_testing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-type-iiiiii-hypothesis-testing">Introduction to Type I/II/III Hypothesis Testing<a class="anchor" aria-label="anchor" href="#introduction-to-type-iiiiii-hypothesis-testing"></a>
</h2>
<p>Type I/II/III hypothesis testing originates from analysis of
variance, however, <span class="citation">Goodnight (1980)</span>
suggests viewing this issue as hypothesis testing of fixed effects in
linear models, which avoid the “usual assumptions” and defined three
types of estimable functions. Given that type I estimable functions are
dependent on the specific order of used covariates, we focus on the type
II and III testing here.</p>
<p>For MMRM, obtaining estimable functions is equivalent to obtaining
the contrasts for linear hypothesis tests. For more details, see <span class="citation">Goodnight (1980)</span>.</p>
</div>
<div class="section level2">
<h2 id="contained-effect">Contained Effect<a class="anchor" aria-label="anchor" href="#contained-effect"></a>
</h2>
<p>Before we discuss the testing, it is important that we understand the
concept of “contained effect”. The definition of “contained effect”
is:</p>
<p>For effect <span class="math inline">\(E_2\)</span>, it is said to
contain <span class="math inline">\(E_1\)</span> if</p>
<ol style="list-style-type: decimal">
<li>the involved numerical covariate(s) are identical for these two
effects</li>
<li>all the categorical covariate(s) associated with <span class="math inline">\(E_1\)</span> are also associated with <span class="math inline">\(E_2\)</span>
</li>
</ol>
<p>For example, for the following model formula</p>
<p><span class="math inline">\(Y = A + B + A*B\)</span></p>
<p>using <span class="math inline">\(E_A\)</span>, <span class="math inline">\(E_B\)</span> and <span class="math inline">\(E_{A*B}\)</span> to denote the effect for <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>
and <span class="math inline">\(A*B\)</span> respectively, we have</p>
<ol style="list-style-type: decimal">
<li>If <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are both categorical, then <span class="math inline">\(E_{A*B}\)</span> contains <span class="math inline">\(E_{A}\)</span> and <span class="math inline">\(E_{B}\)</span>.</li>
<li>If <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are both numerical, then <span class="math inline">\(E_{A*B}\)</span> do not contain <span class="math inline">\(E_{A}\)</span> or <span class="math inline">\(E_{B}\)</span>.</li>
<li>If <span class="math inline">\(A\)</span> is categorical and <span class="math inline">\(B\)</span> is numerical, then <span class="math inline">\(E_{A*B}\)</span> contains <span class="math inline">\(E_{B}\)</span> but not <span class="math inline">\(E_{A}\)</span>.</li>
</ol>
</div>
<div class="section level2">
<h2 id="type-ii-hypothesis-testing">Type II Hypothesis Testing<a class="anchor" aria-label="anchor" href="#type-ii-hypothesis-testing"></a>
</h2>
<p>For type II hypothesis testing, the contrasts can be obtained through
the following steps:</p>
<p>Create a contrast matrix <span class="math inline">\(L\)</span>, with
rows equal to the number of parameters associated with the effect,
columns equal to the number of all parameters, <em>including aliased
parameters</em>.</p>
<ol style="list-style-type: decimal">
<li>All columns of <span class="math inline">\(L\)</span> associated
with effect not containing <span class="math inline">\(E_1\)</span>
(except <span class="math inline">\(E_1\)</span>) are set to 0.</li>
<li>The submatrix of <span class="math inline">\(L\)</span> associated
with <span class="math inline">\(E_1\)</span> is set to <span class="math inline">\((X_1^\top M X_1)^{-}X_1^\top M X_1\)</span>
</li>
<li>Each of the remaining submatrices of L associated with an effect
<span class="math inline">\(E_2\)</span> that contains <span class="math inline">\(E_1\)</span> is <span class="math inline">\((X_1^\top M X_1)^{-}X_1^\top M X_2\)</span>
</li>
<li>Columns associated with aliased parameters are dropped.</li>
</ol>
<p>where <span class="math inline">\(X_0\)</span> stands for columns of
<span class="math inline">\(X\)</span> whose associated effect do not
contain <span class="math inline">\(E_1\)</span>, <span class="math inline">\(X_1\)</span> stands for columns of <span class="math inline">\(X\)</span> associated with <span class="math inline">\(E_1\)</span>, <span class="math inline">\(X_2\)</span> stands for columns of <span class="math inline">\(X\)</span> whose associated effect contains <span class="math inline">\(E_1\)</span>, <span class="math inline">\(M = I -
X_0(X_0^\top X_0)^{-}X_0^\top\)</span>, and <span class="math inline">\(Z^{-}\)</span> stands for the <a href="https://blogs.sas.com/content/iml/2018/11/21/generalized-inverses-for-matrices.html" class="external-link">g2
inverse</a> of <span class="math inline">\(Z\)</span>.</p>
<p>Note: Here we do not allow for singularity in general, so the g2
inverse is just the usual inverse. Thus we can use an identity matrix as
the submatrix in step 2.</p>
<p>Using <code>fev_data</code> to create our example, we have</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/mmrm/">mmrm</a></span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmrm.html">mmrm</a></span><span class="op">(</span><span class="va">FEV1</span> <span class="op">~</span> <span class="va">ARMCD</span> <span class="op">+</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">RACE</span> <span class="op">+</span> <span class="fu">ar1</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">fev_data</span><span class="op">)</span></span></code></pre></div>
<p>For this given example, we would like to test the effect of
<code>RACE</code>, <span class="math inline">\(E_{RACE}\)</span>. We
initialize the contrast matrix with</p>
<p><span class="math display">\[
\begin{matrix}
\mu &amp; ARMCD &amp; RACE &amp; RACE &amp; ARMCD:RACE &amp;
ARMCD:RACE\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
\end{matrix}
\]</span></p>
<p>Please note that this is a <span class="math inline">\(2\times
6\)</span> matrix, the rows is the number of coefficients that is
associated with <code>RACE</code>, and the columns is the total number
of coefficients 6.</p>
<p>Then following step 2, we filled in the identity matrix in the
corresponding submatrix</p>
<p><span class="math display">\[
\begin{matrix}
\mu &amp; ARMCD &amp; RACE &amp; RACE &amp; ARMCD:RACE &amp;
ARMCD:RACE\\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0\\
\end{matrix}
\]</span></p>
<p>In the last step, for the last 2 columns, we fill the values with the
calculated result.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/component.html">component</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"x_matrix"</span><span class="op">)</span></span>
<span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">x0</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x0</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">x0</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x0</span><span class="op">)</span> <span class="co"># solve is used because the matrix is inversible</span></span>
<span><span class="va">sub_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">m</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">x1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">m</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">x2</span></span>
<span><span class="va">sub_mat</span></span></code></pre></div>
<pre><code><span><span class="co">##                               ARMCDTRT:RACEBlack or African American</span></span>
<span><span class="co">## RACEBlack or African American                             0.42618692</span></span>
<span><span class="co">## RACEWhite                                                -0.04372702</span></span>
<span><span class="co">##                               ARMCDTRT:RACEWhite</span></span>
<span><span class="co">## RACEBlack or African American         0.02751985</span></span>
<span><span class="co">## RACEWhite                             0.58570969</span></span></code></pre>
<p><span class="math display">\[
\begin{matrix}
\mu &amp; ARMCD &amp; RACE &amp; RACE &amp; ARMCD:RACE &amp;
ARMCD:RACE\\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0.42618692 &amp; 0.02751985\\
0 &amp; 0 &amp; 0 &amp; 1 &amp; -0.04372702 &amp; 0.58570969\\
\end{matrix}
\]</span></p>
</div>
<div class="section level2">
<h2 id="type-iii-hypothesis-testing">Type III Hypothesis Testing<a class="anchor" aria-label="anchor" href="#type-iii-hypothesis-testing"></a>
</h2>
<p>For Type III hypothesis testing, we assume that the hypothesis tested
should be the same for all designs with the same general form of
estimable functions.</p>
<p>An important consideration for Type III testing is that it should be
performed with orthogonal contrasts for the categorical covariates. In R
this can be achieved via using e.g. the <code>contr.sum</code> contrasts
for the categorical covariates. However, the default in R are treatment
contrasts, via <code>contr.treatment</code>. Therefore, to ensure that
Type III tests are performed correctly, independently of which contrasts
happen to be used in the model fitting, we follow this algorithm:</p>
<ol style="list-style-type: decimal">
<li>Based on the user specification in the data frame we construct a
design matrix, say <span class="math inline">\(X_t\)</span> (this could
be using all <code>contr.treatment</code> or a mixture of contrasts for
factor variables).</li>
<li>We also construct the design matrix with <code>contr.sum</code> for
all factor variables, say <span class="math inline">\(X_c\)</span>.</li>
<li>We construct the Type III contrast matrices <span class="math inline">\(L_{c,j}\)</span> for all terms <span class="math inline">\(j\)</span> for the coefficient estimate based on
the <span class="math inline">\(X_c\)</span> design matrix:</li>
</ol>
<ul>
<li>All columns of <span class="math inline">\(L_{c,j}\)</span>
associated with effect not being <span class="math inline">\(E_j\)</span> are set to 0.</li>
<li>The submatrix of <span class="math inline">\(L_{c,j}\)</span>
associated with <span class="math inline">\(E_j\)</span> is set to the
identity matrix.</li>
</ul>
<ol style="list-style-type: decimal">
<li>We calculate a correction matrix <span class="math inline">\(C =
(X_c^\top X_c)^{-1} X_c^\top X_t\)</span> and obtain corrected Type III
contrast matrices subsequently as <span class="math inline">\(L_{t,j} =
L_{c,j} C\)</span>.</li>
<li>We perform the linear hypothesis tests with the contrast matrices
<span class="math inline">\(L_{t,j}\)</span> for our coefficient
estimate.</li>
</ol>
<p>Note that an intercept term should be included in a model when
performing Type III tests: otherwise one of the categorical covariates
will have an arbitrary high test statistic value. This behavior is
different from SAS, but consistent with other <code><a href="https://rdrr.io/pkg/car/man/Anova.html" class="external-link">car::Anova()</a></code>
results e.g. from linear or generalized linear models. In order to guide
the user, a warning message is issued when Type III tests are requested
for models without an intercept.</p>
</div>
<div class="section level2">
<h2 id="hypothesis-testing-in-sas">Hypothesis Testing in SAS<a class="anchor" aria-label="anchor" href="#hypothesis-testing-in-sas"></a>
</h2>
<p>In <code>PROC MIXED</code> we can specify <code>HTYPE=1,2,3</code> to
enable these hypothesis testings, and we can use option
<code>e1 e2 e3</code> to view the estimable functions.</p>
<div class="section level3">
<h3 id="special-considerations">Special Considerations<a class="anchor" aria-label="anchor" href="#special-considerations"></a>
</h3>
<div class="section level4">
<h4 id="reference-levels">Reference Levels<a class="anchor" aria-label="anchor" href="#reference-levels"></a>
</h4>
<p>For <code>PROC MIXED</code>, it is important that the categorical
values have the correct order, especially for structured covariance
(otherwise the correlation between visits can be messed up). We usually
use <code>CLASS variable(REF=)</code> to define the reference level.
However, SAS will put the reference level in the last, so if the visit
variable is included in fixed effect, there can be issues with the
comparison between SAS and R, as in R we still use the first level as
our reference.</p>
<p>When we conduct the hypothesis testing, we will also face this issue.
If reference level is different, the testing we have can be different,
e.g. if we have 3 levels, <span class="math inline">\(l_1\)</span>,
<span class="math inline">\(l_2\)</span> and <span class="math inline">\(l_3\)</span>. In theory we can test either <span class="math inline">\(l_2 - l_1\)</span>, <span class="math inline">\(l_3 - l_1\)</span> (using <span class="math inline">\(l_1\)</span> as reference), or test <span class="math inline">\(l_1 - l_3\)</span>, <span class="math inline">\(l_2 - l_3\)</span> (using <span class="math inline">\(l_3\)</span> as reference). But the result will be
slightly different. However, if we have identical tests the result will
be closer. The following example illustrate this.</p>
<div class="section level5">
<h5 id="example-of-reference-levels">Example of Reference Levels<a class="anchor" aria-label="anchor" href="#example-of-reference-levels"></a>
</h5>
<p>Assume in SAS we have the following model</p>
<pre><code>PROC MIXED DATA = fev cl method=reml;
  CLASS AVISIT(ref = 'VIS4') ARMCD(ref = 'PBO') USUBJID;
  MODEL FEV1 = ARMCD AVISIT ARMCD*AVISIT / ddfm=satterthwaite htype=3;
  REPEATED AVISIT / subject=USUBJID type=ar(1);
RUN;</code></pre>
<p>And in R we have the following model</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mmrm.html">mmrm</a></span><span class="op">(</span><span class="va">FEV1</span> <span class="op">~</span> <span class="va">ARMCD</span> <span class="op">+</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="fu">ar1</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">fev_data</span><span class="op">)</span></span>
<span><span class="fu">Anova</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p>Note that for <code>AVISIT</code> there are 4 levels,
<code>VIS1</code>, <code>VIS2</code>, <code>VIS3</code> and
<code>VIS4</code>. In SAS <code>VIS4</code> is the reference, while in R
<code>VIS1</code> is the reference.</p>
<p>They both use the following matrix to test the effect of
<code>AVISIT</code> (ignoring other part of contrasts that is not
associated with <code>AVISIT</code>)</p>
<p><span class="math display">\[
\begin{matrix}
1 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 0\\
0 &amp; 0 &amp; 1\\
\end{matrix}
\]</span></p>
<p>But given that the reference level is different, we are testing
different things. In SAS we are testing <code>VIS1 - VIS4</code>,
<code>VIS2 - VIS4</code> and <code>VIS3 - VIS4</code>, while in R we are
testing <code>VIS2 - VIS1</code>, <code>VIS3 - VIS1</code> and
<code>VIS4 - VIS1</code>.</p>
<p>To correctly test <code>VIS1 - VIS4</code>, <code>VIS2 - VIS4</code>
and <code>VIS3 - VIS4</code> in R, we need to update the contrast to the
following matrix (ignoring the other part) to get a closer result.</p>
<p><span class="math display">\[
\begin{matrix}
0 &amp; 1 &amp; 0\\
0 &amp; 0 &amp; 1\\
-1 &amp; -1 &amp; -1\\
\end{matrix}
\]</span></p>
</div>
</div>
<div class="section level4">
<h4 id="why-model-covariate-order-changes-my-testing-in-sas">Why Model Covariate Order Changes My Testing in SAS?<a class="anchor" aria-label="anchor" href="#why-model-covariate-order-changes-my-testing-in-sas"></a>
</h4>
<p>For type II/III testing, it is true that the order of covariate
should not affect the result. However, if there is an interaction term,
the reference level can be changed. With different reference levels the
result will be slightly different.</p>
</div>
<div class="section level4">
<h4 id="why-mmrm-gives-more-covariates-than-sas">Why <code>mmrm</code> Gives More Covariates Than SAS?<a class="anchor" aria-label="anchor" href="#why-mmrm-gives-more-covariates-than-sas"></a>
</h4>
<p>For <code>PROC MIXED</code>, if a model is specified as follows</p>
<pre><code>MODEL FEV1 = ARMCD SEX ARMCD * SEX ARMCD * FEV1_BL</code></pre>
<p>Then it is equivalent to the following <code>mmrm</code> model</p>
<pre><code><span><span class="va">FEV1</span> <span class="op">~</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">FEV1_BL</span> <span class="op">-</span> <span class="va">FEV1_BL</span></span></code></pre>
<p>or</p>
<pre><code><span><span class="va">FEV1</span> <span class="op">~</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">ARMCD</span><span class="op">:</span><span class="va">FEV1_BL</span></span></code></pre>
<p>Because SAS will not include the covariate <code>FEV1_BL</code> by
default, unless manually added. However in R we will add
<code>FEV1_BL</code> by default. Please note that in this example we
exclude the covariance structure part.</p>
</div>
<div class="section level4">
<h4 id="excluding-columns-due-to-collinearity">Excluding columns due to collinearity<a class="anchor" aria-label="anchor" href="#excluding-columns-due-to-collinearity"></a>
</h4>
<p><code><a href="../reference/mmrm.html">mmrm::mmrm()</a></code> (which employs <code><a href="https://rdrr.io/r/base/qr.html" class="external-link">qr()</a></code>) and
<code>PROC MIXED</code> have similar strategies to handle collinearity
of model parameters. Both prioritize earlier columns in the design
matrix, excluding a column if it is a linear combination of earlier
ones. Whereas <code><a href="../reference/mmrm.html">mmrm::mmrm()</a></code> completely excludes such
parameters from the model, <code>PROC MIXED</code> retains them but
assigns a coefficient of 0. The presence of these columns is necessary
for the accurate calculation of type-II contrast matrices.</p>
<p>Therefore, an <code>mmrm</code> object contains the full design
matrix including aliased columns in a component called
<code>x_matrix_complete</code>. This matrix is utilized to calculate the
contrast matrices when running a type-II ANOVA. Once all values are
correctly calculated, the final step in contrast matrix creation is to
drop the columns corresponding to the aliased parameters.</p>
</div>
<div class="section level4">
<h4 id="intercept-free-models">Intercept-free models<a class="anchor" aria-label="anchor" href="#intercept-free-models"></a>
</h4>
<p><code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">stats::model.matrix()</a></code> and <code>PROC MIXED</code> handle
intercept-free models in different ways. This has important implications
for the creation of the contrast matrices used for type-II ANOVAs.</p>
<div class="section level5">
<h5 id="intercept-free-models-with-statsmodel-matrix">Intercept-free Models with <code>stats::model.matrix()</code><a class="anchor" aria-label="anchor" href="#intercept-free-models-with-statsmodel-matrix"></a>
</h5>
<p>When the default method of <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">stats::model.matrix()</a></code> is
creating a design matrix for an intercept-free model, it considers the
terms sequentially. When it encounters the first term to contain a
categorical variable, it will include the reference level when creating
this term’s design matrix columns. Therefore, this term de facto
contains the model’s intercept.</p>
</div>
<div class="section level5">
<h5 id="intercept-free-models-with-proc-mixed">Intercept-free Models with <code>PROC MIXED</code><a class="anchor" aria-label="anchor" href="#intercept-free-models-with-proc-mixed"></a>
</h5>
<p><code>PROC MIXED</code>, on the other hand, treats all terms the same
regardless of the presence or absence of an intercept: it always
considers all factor levels for all categorical variables when creating
design matrix columns (see the <strong>Main Effects</strong> and
<strong>Implications of the Non-Full-Rank Parameterization</strong>
sections <a href="https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_mixed_sect023.htm" class="external-link">here</a>).
Therefore, all terms involving categorical variables effectively share
the model’s intercept.</p>
</div>
<div class="section level5">
<h5 id="type-ii-contrast-matrices-in-intercept-free-models">Type-II Contrast Matrices in Intercept-free Models<a class="anchor" aria-label="anchor" href="#type-ii-contrast-matrices-in-intercept-free-models"></a>
</h5>
<p>To accurately run a type-II ANOVA when all levels of a categorical
variable are represented in a design matrix, one of the levels of each
categorical variable must contain subtractive (i.e., negative) values
its corresponding contrast matrix columns. Since <code>PROC MIXED</code>
includes all factor levels of all categorical variables, the
incorporation of negative values is a commonplace occurrence. Negative
values are invariably assigned to the last columns, which are always the
reference levels’ columns.</p>
<p>However, in <code><a href="../reference/mmrm.html">mmrm::mmrm()</a></code>, reference level columns only
exist in intercept-free models for the first term containing a
categorical variable. Thus, <code>mmrm</code>’s helper functions
incorporate a special handling step for such first-categorical-terms in
which their last contrast matrix columns are assigned straight -1s.</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-goodnight1980tests" class="csl-entry">
Goodnight JH (1980). <span>“Tests of Hypotheses in Fixed Effects Linear
Models.”</span> <em>Communications in Statistics-Theory and
Methods</em>, <strong>9</strong>(2), 167–180.
</div>
</div>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Sabanes Bove, Liming Li, Julia Dedic, Doug Kelkhoff, Kevin Kunzmann, Brian Matthew Lang, Christian Stock, Ya Wang, Dan James, Jonathan Sidi, Daniel Leibovitz, Daniel D. Sjoberg, Nikolas Ivan Krieger, Boehringer Ingelheim Ltd., Gilead Sciences, Inc., F. Hoffmann-La Roche AG, Merck Sharp &amp; Dohme, Inc., AstraZeneca plc, inferential.biostatistics GmbH.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
