<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mmrm">
<title> • mmrm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="mmrm">
<meta property="og:image" content="https://openpharma.github.io/mmrm/main/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125641273-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">mmrm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2.9030</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../../articles/algorithm.html">Details of the Model Fitting in `mmrm`</a>
    <a class="dropdown-item" href="../../articles/coef_vcov.html">Coefficients Covariance Matrix Adjustment in `mmrm`</a>
    <a class="dropdown-item" href="../../articles/covariance.html">Covariance Structures in `mmrm`</a>
    <a class="dropdown-item" href="../../articles/empirical_wls.html">Weighted Least Square Empirical Covariance</a>
    <a class="dropdown-item" href="../../articles/introduction.html">Introduction to `mmrm`</a>
    <a class="dropdown-item" href="../../articles/kenward.html">Details of the Kenward-Roger calculations</a>
    <a class="dropdown-item" href="../../articles/methodological_introduction.html">What are MMRMs? A brief introduction</a>
    <a class="dropdown-item" href="../../articles/mmrm_review_methods.html">Implementations of MMRM: a comparison of what's available</a>
    <a class="dropdown-item" href="../../articles/package_structure.html">Package Structure</a>
    <a class="dropdown-item" href="../../articles/predict.html">Predicting from a MMRM</a>
    <a class="dropdown-item" href="../../articles/satterthwaite.html">Details of the Satterthwaite calculations</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-acknowledgments.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-customizations.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-getting_started.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-hypothesis_testing.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-lower_level.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-model_features.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-tidymodels.html">UNKNOWN TITLE</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">Changelog</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../../coverage-report/">Coverage report</a>
    <a class="dropdown-item" href="../../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/openpharma/mmrm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.svg" class="logo" alt=""><h1></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/mmrm/blob/HEAD/vignettes/subsections/intro-customizations.Rmd" class="external-link"><code>vignettes/subsections/intro-customizations.Rmd</code></a></small>
      <div class="d-none name"><code>intro-customizations.Rmd</code></div>
    </div>

    
    
<p>From the high-level <a href="https://openpharma.github.io/mmrm/main/reference/mmrm.html"><code>mmrm()</code></a>
interface, common changes to the default function call can be
specified.</p>
<div class="section level2">
<h2 id="control-function">Control Function<a class="anchor" aria-label="anchor" href="#control-function"></a>
</h2>
<p>For fine control, <a href="https://openpharma.github.io/mmrm/main/reference/mmrm_control.html"><code>mmrm_control()</code></a>
is provided. This function allows the user to choose the adjustment
method for the degrees of freedom and the coefficients covariance
matrix, specify optimization routines, number of cores to be used on
Unix systems for trying several optimizers in parallel, provide a vector
of starting parameter values, decide the action to be taken when the
defined design matrix is singular, not drop unobserved visit levels. For
example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/mmrm_control.html">mmrm_control</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="st">"Kenward-Roger"</span>,</span>
<span>  optimizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L-BFGS-B"</span>, <span class="st">"BFGS"</span><span class="op">)</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  accept_singular <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  drop_visit_levels <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that this control list can either be passed via the
<code>control</code> argument to <code>mmrm</code>, or selected controls
can be directly specified in the <code>mmrm</code> call. We will see
this below.</p>
</div>
<div class="section level2">
<h2 id="reml-or-ml">REML or ML<a class="anchor" aria-label="anchor" href="#reml-or-ml"></a>
</h2>
<p>Users can specify if REML should be used (default) or if ML should be
used in optimization.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mmrm.html">mmrm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="fu">us</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">fev_data</span>,</span>
<span>  reml <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_ml</span></span></code></pre></div>
<pre><code><span><span class="co">## mmrm fit</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:     FEV1 ~ RACE + ARMCD * AVISIT + us(AVISIT | USUBJID)</span></span>
<span><span class="co">## Data:        fev_data (used 537 observations from 197 subjects with maximum 4 </span></span>
<span><span class="co">## timepoints)</span></span>
<span><span class="co">## Covariance:  unstructured (10 variance parameters)</span></span>
<span><span class="co">## Inference:   ML</span></span>
<span><span class="co">## Deviance:    3397.934</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients: </span></span>
<span><span class="co">##                   (Intercept) RACEBlack or African American </span></span>
<span><span class="co">##                    30.9663423                     1.5086851 </span></span>
<span><span class="co">##                     RACEWhite                      ARMCDTRT </span></span>
<span><span class="co">##                     5.6133151                     3.7761037 </span></span>
<span><span class="co">##                    AVISITVIS2                    AVISITVIS3 </span></span>
<span><span class="co">##                     4.8270155                    10.3353319 </span></span>
<span><span class="co">##                    AVISITVIS4           ARMCDTRT:AVISITVIS2 </span></span>
<span><span class="co">##                    15.0487715                    -0.0156154 </span></span>
<span><span class="co">##           ARMCDTRT:AVISITVIS3           ARMCDTRT:AVISITVIS4 </span></span>
<span><span class="co">##                    -0.6663598                     0.6317222 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model Inference Optimization:</span></span>
<span><span class="co">## Converged with code 0 and message: convergence: rel_reduction_of_f &lt;= factr*epsmch</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="optimizer">Optimizer<a class="anchor" aria-label="anchor" href="#optimizer"></a>
</h2>
<p>Users can specify which optimizer should be used, changing from the
default of four optimizers, which starts with <code>L-BFGS-B</code> and
proceeds through the other choices if optimization fails to converge.
Other choices are <code>BFGS</code>, <code>CG</code>,
<code>nlminb</code> and other user-defined custom optimizers.</p>
<p><code>L-BFGS-B</code>, <code>BFGS</code> and <code>CG</code> are all
implemented with <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim()</a></code> and the Hessian is not
used, while <code>nlminb</code> is using <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code>
which in turn uses both the gradient and the Hessian (by default but can
be switch off) for the optimization.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mmrm.html">mmrm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="fu">us</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">fev_data</span>,</span>
<span>  optimizer <span class="op">=</span> <span class="st">"BFGS"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_opt</span></span></code></pre></div>
<pre><code><span><span class="co">## mmrm fit</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:     FEV1 ~ RACE + ARMCD * AVISIT + us(AVISIT | USUBJID)</span></span>
<span><span class="co">## Data:        fev_data (used 537 observations from 197 subjects with maximum 4 </span></span>
<span><span class="co">## timepoints)</span></span>
<span><span class="co">## Covariance:  unstructured (10 variance parameters)</span></span>
<span><span class="co">## Inference:   REML</span></span>
<span><span class="co">## Deviance:    3387.373</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients: </span></span>
<span><span class="co">##                   (Intercept) RACEBlack or African American </span></span>
<span><span class="co">##                    30.9676902                     1.5046744 </span></span>
<span><span class="co">##                     RACEWhite                      ARMCDTRT </span></span>
<span><span class="co">##                     5.6131048                     3.7755423 </span></span>
<span><span class="co">##                    AVISITVIS2                    AVISITVIS3 </span></span>
<span><span class="co">##                     4.8285855                    10.3331770 </span></span>
<span><span class="co">##                    AVISITVIS4           ARMCDTRT:AVISITVIS2 </span></span>
<span><span class="co">##                    15.0525706                    -0.0173504 </span></span>
<span><span class="co">##           ARMCDTRT:AVISITVIS3           ARMCDTRT:AVISITVIS4 </span></span>
<span><span class="co">##                    -0.6675190                     0.6309586 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model Inference Optimization:</span></span>
<span><span class="co">## Converged with code 0 and message:</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="covariance-structure">Covariance Structure<a class="anchor" aria-label="anchor" href="#covariance-structure"></a>
</h2>
<p>Covariance structures supported by the <code>mmrm</code> are being
continuously developed. For a complete list and description please visit
the <a href="covariance.html">covariance vignette</a>. Below we see the
function call for homogeneous compound symmetry (<code>cs</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_cs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mmrm.html">mmrm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="fu">cs</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">fev_data</span>,</span>
<span>  reml <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_cs</span></span></code></pre></div>
<pre><code><span><span class="co">## mmrm fit</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:     FEV1 ~ RACE + ARMCD * AVISIT + cs(AVISIT | USUBJID)</span></span>
<span><span class="co">## Data:        fev_data (used 537 observations from 197 subjects with maximum 4 </span></span>
<span><span class="co">## timepoints)</span></span>
<span><span class="co">## Covariance:  compound symmetry (2 variance parameters)</span></span>
<span><span class="co">## Inference:   ML</span></span>
<span><span class="co">## Deviance:    3536.989</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients: </span></span>
<span><span class="co">##                   (Intercept) RACEBlack or African American </span></span>
<span><span class="co">##                    31.4207077                     0.5357237 </span></span>
<span><span class="co">##                     RACEWhite                      ARMCDTRT </span></span>
<span><span class="co">##                     5.4546329                     3.4305212 </span></span>
<span><span class="co">##                    AVISITVIS2                    AVISITVIS3 </span></span>
<span><span class="co">##                     4.8326353                    10.2395076 </span></span>
<span><span class="co">##                    AVISITVIS4           ARMCDTRT:AVISITVIS2 </span></span>
<span><span class="co">##                    15.0672680                     0.2801641 </span></span>
<span><span class="co">##           ARMCDTRT:AVISITVIS3           ARMCDTRT:AVISITVIS4 </span></span>
<span><span class="co">##                    -0.5894964                     0.7939750 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model Inference Optimization:</span></span>
<span><span class="co">## Converged with code 0 and message: convergence: rel_reduction_of_f &lt;= factr*epsmch</span></span></code></pre>
<p>The time points have to be unique for each subject. That is, there
cannot be time points with multiple observations for any subject. The
rationale is that these observations would need to be correlated, but it
is not possible within the currently implemented covariance structure
framework to do that correctly. Moreover, for non-spatial covariance
structures, the time variable must be coded as a factor.</p>
</div>
<div class="section level2">
<h2 id="weighting">Weighting<a class="anchor" aria-label="anchor" href="#weighting"></a>
</h2>
<p>Users can perform weighted MMRM by specifying a numeric vector
<code>weights</code> with positive values.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_wt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mmrm.html">mmrm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="fu">us</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">fev_data</span>,</span>
<span>  weights <span class="op">=</span> <span class="va">fev_data</span><span class="op">$</span><span class="va">WEIGHT</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_wt</span></span></code></pre></div>
<pre><code><span><span class="co">## mmrm fit</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:     FEV1 ~ RACE + ARMCD * AVISIT + us(AVISIT | USUBJID)</span></span>
<span><span class="co">## Data:        fev_data (used 537 observations from 197 subjects with maximum 4 </span></span>
<span><span class="co">## timepoints)</span></span>
<span><span class="co">## Weights:     fev_data$WEIGHT</span></span>
<span><span class="co">## Covariance:  unstructured (10 variance parameters)</span></span>
<span><span class="co">## Inference:   REML</span></span>
<span><span class="co">## Deviance:    3476.526</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients: </span></span>
<span><span class="co">##                   (Intercept) RACEBlack or African American </span></span>
<span><span class="co">##                   31.20065229                    1.18452837 </span></span>
<span><span class="co">##                     RACEWhite                      ARMCDTRT </span></span>
<span><span class="co">##                    5.36525917                    3.39695951 </span></span>
<span><span class="co">##                    AVISITVIS2                    AVISITVIS3 </span></span>
<span><span class="co">##                    4.85890820                   10.03942420 </span></span>
<span><span class="co">##                    AVISITVIS4           ARMCDTRT:AVISITVIS2 </span></span>
<span><span class="co">##                   14.79354054                    0.03418184 </span></span>
<span><span class="co">##           ARMCDTRT:AVISITVIS3           ARMCDTRT:AVISITVIS4 </span></span>
<span><span class="co">##                    0.01308088                    0.86701567 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model Inference Optimization:</span></span>
<span><span class="co">## Converged with code 0 and message: convergence: rel_reduction_of_f &lt;= factr*epsmch</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="grouped-covariance-structure">Grouped Covariance Structure<a class="anchor" aria-label="anchor" href="#grouped-covariance-structure"></a>
</h2>
<p>Grouped covariance structures are supported by the<code>mmrm</code>
package. Covariance matrices for each group are identically structured
(unstructured, compound symmetry, etc) but the estimates are allowed to
vary across groups. We use the form
<code>cs(time | group / subject)</code> to specify the group
variable.</p>
<p>Here is an example of how we use <code>ARMCD</code> as group
variable.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_cs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mmrm.html">mmrm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="fu">cs</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">ARMCD</span> <span class="op">/</span> <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">fev_data</span>,</span>
<span>  reml <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/mmrm_tmb_methods.html">VarCorr</a></span><span class="op">(</span><span class="va">fit_cs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $PBO</span></span>
<span><span class="co">##           VIS1      VIS2      VIS3      VIS4</span></span>
<span><span class="co">## VIS1 37.823638  3.601296  3.601296  3.601296</span></span>
<span><span class="co">## VIS2  3.601296 37.823638  3.601296  3.601296</span></span>
<span><span class="co">## VIS3  3.601296  3.601296 37.823638  3.601296</span></span>
<span><span class="co">## VIS4  3.601296  3.601296  3.601296 37.823638</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $TRT</span></span>
<span><span class="co">##          VIS1     VIS2     VIS3     VIS4</span></span>
<span><span class="co">## VIS1 49.58110 10.98112 10.98112 10.98112</span></span>
<span><span class="co">## VIS2 10.98112 49.58110 10.98112 10.98112</span></span>
<span><span class="co">## VIS3 10.98112 10.98112 49.58110 10.98112</span></span>
<span><span class="co">## VIS4 10.98112 10.98112 10.98112 49.58110</span></span></code></pre>
<p>We can see that the estimated covariance matrices are different in
different <code>ARMCD</code> groups.</p>
</div>
<div class="section level2">
<h2 id="adjustment-method">Adjustment Method<a class="anchor" aria-label="anchor" href="#adjustment-method"></a>
</h2>
<p>In additional to the residual degrees of freedom, both Satterthwaite
and Kenward-Roger adjustment methods are available. The default is
Satterthwaite adjustment of the degrees of freedom. To use Kenward-Roger
adjustment of the degrees of freedom as well as the coefficients
covariance matrix, use the <code>method</code> argument:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_kr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mmrm.html">mmrm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="fu">us</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">fev_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"Kenward-Roger"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that this requires <code>reml = TRUE</code>, i.e. Kenward-Roger
adjustment is not possible when using maximum likelihood inference.
While this adjustment choice is not visible in the <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>
result of the fitted model (because the initial model fit is not
affected by the choice of the adjustment method), looking at the
<code>summary</code> we see the method and the correspondingly adjusted
standard errors and degrees of freedom:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_kr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## mmrm fit</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:     FEV1 ~ RACE + ARMCD * AVISIT + us(AVISIT | USUBJID)</span></span>
<span><span class="co">## Data:        fev_data (used 537 observations from 197 subjects with maximum 4 </span></span>
<span><span class="co">## timepoints)</span></span>
<span><span class="co">## Covariance:  unstructured (10 variance parameters)</span></span>
<span><span class="co">## Method:      Kenward-Roger</span></span>
<span><span class="co">## Vcov Method: Kenward-Roger</span></span>
<span><span class="co">## Inference:   REML</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model selection criteria:</span></span>
<span><span class="co">##      AIC      BIC   logLik deviance </span></span>
<span><span class="co">##   3407.4   3440.2  -1693.7   3387.4 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients: </span></span>
<span><span class="co">##                                Estimate Std. Error        df t value Pr(&gt;|t|)</span></span>
<span><span class="co">## (Intercept)                    30.96770    0.83335 187.91000  37.160  &lt; 2e-16</span></span>
<span><span class="co">## RACEBlack or African American   1.50465    0.62901 169.95000   2.392  0.01784</span></span>
<span><span class="co">## RACEWhite                       5.61310    0.67139 158.87000   8.360 2.98e-14</span></span>
<span><span class="co">## ARMCDTRT                        3.77556    1.07910 146.27000   3.499  0.00062</span></span>
<span><span class="co">## AVISITVIS2                      4.82859    0.80408 143.66000   6.005 1.49e-08</span></span>
<span><span class="co">## AVISITVIS3                     10.33317    0.82303 155.66000  12.555  &lt; 2e-16</span></span>
<span><span class="co">## AVISITVIS4                     15.05256    1.30180 138.39000  11.563  &lt; 2e-16</span></span>
<span><span class="co">## ARMCDTRT:AVISITVIS2            -0.01737    1.13154 138.39000   0.015  0.98777</span></span>
<span><span class="co">## ARMCDTRT:AVISITVIS3            -0.66753    1.18714 158.21000   0.562  0.57470</span></span>
<span><span class="co">## ARMCDTRT:AVISITVIS4             0.63094    1.83319 129.64000   0.344  0.73127</span></span>
<span><span class="co">##                                  </span></span>
<span><span class="co">## (Intercept)                   ***</span></span>
<span><span class="co">## RACEBlack or African American *  </span></span>
<span><span class="co">## RACEWhite                     ***</span></span>
<span><span class="co">## ARMCDTRT                      ***</span></span>
<span><span class="co">## AVISITVIS2                    ***</span></span>
<span><span class="co">## AVISITVIS3                    ***</span></span>
<span><span class="co">## AVISITVIS4                    ***</span></span>
<span><span class="co">## ARMCDTRT:AVISITVIS2              </span></span>
<span><span class="co">## ARMCDTRT:AVISITVIS3              </span></span>
<span><span class="co">## ARMCDTRT:AVISITVIS4              </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Covariance estimate:</span></span>
<span><span class="co">##         VIS1    VIS2    VIS3    VIS4</span></span>
<span><span class="co">## VIS1 40.7335 14.2740  5.1411 13.5288</span></span>
<span><span class="co">## VIS2 14.2740 26.2243  2.6391  7.3219</span></span>
<span><span class="co">## VIS3  5.1411  2.6391 14.9497  1.0341</span></span>
<span><span class="co">## VIS4 13.5288  7.3219  1.0341 95.6006</span></span></code></pre>
<p>For one-dimensional contrasts as in the coefficients table above, the
degrees of freedom are the same for Kenward-Roger and Satterthwaite.
However, Kenward-Roger uses adjusted standard errors, hence the p-values
are different.</p>
<p>Note that if you would like to match SAS results for an unstructured
covariance model, you can use the linear Kenward-Roger
approximation:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_kr_lin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mmrm.html">mmrm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="fu">us</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">fev_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"Kenward-Roger"</span>,</span>
<span>  vcov <span class="op">=</span> <span class="st">"Kenward-Roger-Linear"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This is due to the different parametrization of the unstructured
covariance matrix, see the <a href="kenward.html#parameterization-methods-and-kenward-roger">Kenward-Roger
vignette</a> for details.</p>
</div>
<div class="section level2">
<h2 id="variance-covariance-for-coefficients">Variance-covariance for Coefficients<a class="anchor" aria-label="anchor" href="#variance-covariance-for-coefficients"></a>
</h2>
<p>There are multiple variance-covariance estimator available for the
coefficients, including:</p>
<ol style="list-style-type: decimal">
<li>Asymptotic</li>
<li>Empirical (Cluster Robust Sandwich)</li>
<li>Empirical-Jackknife</li>
<li>Empirical-Bias-Reduced</li>
<li>Kenward-Roger</li>
<li>Kenward-Roger-Linear</li>
</ol>
<p>Please note that, not all combinations of variance-covariance for
coefficients and method of degrees of freedom are possible,
e.g. “Kenward-Roger” and “Kenward-Roger-Linear” are available only when
the degrees of freedom method is “Kenward-Roger”.</p>
<p>Details can be found in <a href="coef_vcov.html">Coefficients
Covariance Matrix Adjustment vignette</a> and <a href="empirical_wls.html">Weighted Least Square Empirical
Covariance</a>.</p>
</div>
<div class="section level2">
<h2 id="keeping-unobserved-visits">Keeping Unobserved Visits<a class="anchor" aria-label="anchor" href="#keeping-unobserved-visits"></a>
</h2>
<p>Sometimes not all possible time points are observed in a given data
set. When using a structured covariance matrix, e.g. with
auto-regressive structure, then it can be relevant to keep the correct
distance between the observed time points.</p>
<p>Consider the following example where we have deliberately removed the
<code>VIS3</code> observations from our initial example data set
<code>fev_data</code> to obtain <code>sparse_data</code>. We first fit
the model where we do not drop the visit level explicitly, using the
<code>drop_visit_levels = FALSE</code> choice. Second we fit the model
by default without this option.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sparse_data</span> <span class="op">&lt;-</span> <span class="va">fev_data</span><span class="op">[</span><span class="va">fev_data</span><span class="op">$</span><span class="va">AVISIT</span> <span class="op">!=</span> <span class="st">"VIS3"</span>, <span class="op">]</span></span>
<span><span class="va">sparse_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mmrm.html">mmrm</a></span><span class="op">(</span></span>
<span>  <span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="fu">ar1</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">sparse_data</span>,</span>
<span>  drop_visit_levels <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dropped_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mmrm.html">mmrm</a></span><span class="op">(</span></span>
<span>  <span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="fu">ar1</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">sparse_data</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## In AVISIT there are dropped visits: VIS3</span></span></code></pre>
<p>We see that we get a message about the dropped visit level by
default. Now we can compare the estimated correlation matrices:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov2cor</a></span><span class="op">(</span><span class="fu"><a href="../../reference/mmrm_tmb_methods.html">VarCorr</a></span><span class="op">(</span><span class="va">sparse_result</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            VIS1      VIS2      VIS3       VIS4</span></span>
<span><span class="co">## VIS1 1.00000000 0.4051834 0.1641736 0.06652042</span></span>
<span><span class="co">## VIS2 0.40518341 1.0000000 0.4051834 0.16417360</span></span>
<span><span class="co">## VIS3 0.16417360 0.4051834 1.0000000 0.40518341</span></span>
<span><span class="co">## VIS4 0.06652042 0.1641736 0.4051834 1.00000000</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov2cor</a></span><span class="op">(</span><span class="fu"><a href="../../reference/mmrm_tmb_methods.html">VarCorr</a></span><span class="op">(</span><span class="va">dropped_result</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            VIS1      VIS2       VIS4</span></span>
<span><span class="co">## VIS1 1.00000000 0.1468464 0.02156386</span></span>
<span><span class="co">## VIS2 0.14684640 1.0000000 0.14684640</span></span>
<span><span class="co">## VIS4 0.02156386 0.1468464 1.00000000</span></span></code></pre>
<p>We see that when using the default, second result, we just drop the
<code>VIS3</code> from the covariance matrix. As a consequence, we model
the correlation between <code>VIS2</code> and <code>VIS4</code> the same
as the correlation between <code>VIS1</code> and <code>VIS2</code>.
Hence we get a smaller correlation estimate here compared to the first
result, which includes <code>VIS3</code> explicitly.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Daniel Sabanes Bove, Julia Dedic, Doug Kelkhoff, Kevin Kunzmann, Brian Matthew Lang, Liming Li, Christian Stock, Ya Wang, Dan James, Jonathan Sidi, Boehringer Ingelheim Ltd., Gilead Sciences, Inc., F. Hoffmann-La Roche AG, Merck Sharp &amp; Dohme, Inc., AstraZeneca plc.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
