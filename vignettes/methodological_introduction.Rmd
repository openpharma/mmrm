---
title: "What are MMRMs? A brief introduction"
package: mmrm
#bibliography: '`r system.file("REFERENCES.bib", package = "mmrm")`'
bibliography: references.bib # temporary bibliography
csl: jrss_style.csl
output:
  rmarkdown::html_document:
          theme: "spacelab"
          highlight: "kate"
          toc: true
          toc_float: true
vignette: |
  %\VignetteIndexEntry{What are MMRMs? A brief introduction}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown} 
editor_options:
  chunk_output_type: console
  markdown:
    wrap: 72
---

## Abstract

Mixed models for repeated measures (MMRMs) are frequently used in the analysis of data from clinical trials. 
They are specifically suited to model continuous variables that were repeatedly measured at discrete time points (or defined time-windows).
In a clinical trial, these time points are typically visits according to a schedule that is pre-defined in the trial protocol.
The distinguishing feature of MMRMs, compared to other implementations of linear mixed models, is that subject-specific random effects (which are not of direct interest for estimation and inference) are considered as residual effects, i.e. they are part of the error correlation matrix.
This vignette provides a brief introduction to MMRMs from a methodological perspective<!--, largely irrespective of issues related to their technical implementation-->. 
MMRMs are described as an extension to basic linear mixed-effects model.
<!-- TO DO: They are also contrasted to other types of statistical models for longitudinal data, such as linear mixed effects models with random intercepts and/or slopes) and models based on generalized estimating equations (GEEs). --> 
The aim of the vignette is to provide a basic orientation and guide for applied statisticians working in the field of clinical trials regarding theoretical underpinnings of MMRMs. In the descriptions of the models below, we generally follow @Pinheiro2000 and @Mallinckrodt2017.


## The basic linear mixed-effects model

@Laird1982 introduced the basic linear mixed-effects model for a single level of grouping to be any model that expresses an $n_i$-dimensional response (column) vector $y_i$ for the $i$th subject (or, more generally, group or unit) as

$$
 y_i = X_i \beta + Z_i b_i + \epsilon_i, \quad i=1,\ldots,M ,\\
 b_i \sim \mathcal{N}(0,\Psi), \quad \epsilon_i \sim \mathcal{N}(0,\sigma^2I),
$$
where 
$\beta$ is the $p$-dimensional vector of fixed effects,
$b$ is the $q$-dimensional vector of random patient-specific effects, 
$X_i$ (of size $n_i \times p$) and $Z_i$ (of size $n_i \times q$) are known regressor matrices relating observations to the fixed-effects and random-effects, respectively, and 
$\epsilon_i$ is the $n_i$-dimensional within-subject error.
<!-- TO DO: explain fixed effects -->
The random effects $b_i$ and the within-group errors $\epsilon_i$ are assumed to  follow a normal distribution, with means of $0$ and variance-covariance matrices  $\Psi$ and $\sigma^2I$, where $I$ is an identity matrix. They are assumed to be independent for different subjects and independent of each other for the same subject.
The random effects $b_i$ describe the shift from the mean of the linear predictor for each subject. As they are defined to have a mean of $0$, any
non-zero mean for a term in the random effects must be expressed as part
of the fixed-effects terms. Therefore, the columns of $Z_i$ are usually a (small) subset of the columns of $X_i$.

Although the basic linear mixed effects model allows considerable flexibility, even in the specification of the random-effects structure, it still restricts within-group errors to be independent, identically distributed random variables with mean zero and constant variance. These assumptions may often be seen as too restrictive (unrealistic) for applications. For example, in case of repeated measurements of subjects over time in clinical trials, observations are not independent and within-subject correlation needs to be accounted for by the model.


## Extending the basic linear mixed-effects model

The basic linear mixed-effects model can be extended to incorporate within-subject errors that are heteroscedastic (i.e.\ have unequal variances) and/ or are correlated.
For this purpose, we express the within-subject errors as:
$$
  \epsilon_i \sim \mathcal{N}(0,\sigma^2\Delta_i), \quad i=1,\ldots,M,
$$
where the $\Delta_i$ are positive-definite matrices parameterized by a fixed, generally
small, set of parameters $\lambda$. As in the basic model, the within-group errors $\epsilon_i$ are assumed to be independent for different $i$ and independent of the random effects $b_i$.

The variance-covariance matrix of the response vector $y_i$,
$$ 
  \text{Var}(y_i) = \Sigma_i = \left( Z_i D Z_{i}^{T} + \Delta_i \right),
$$
comprises a random-effects component, given by $Z_i D Z_{i}^{T}$, and a within-subject component, given by $\Delta_i$. <!-- check D -->
There will generally be a "competition" and trade-off between the complexities of the two components, and care must be exercised to prevent nonidentifiability, or near nonidentifyability, of the parameters.

## The MMRM as a special case

In a clinical trial setting, one often chooses to omit the random effects in the model to account for dependencies and to use the within-group component $\Delta_i$ to directly model the variance-covariance structure of the response. This yields the MMRM:

$$
     y_i = X_i\beta + \epsilon_i, \quad \epsilon_i \sim \mathcal{N}(0,\sigma^2\Delta_i), \quad i=1,\ldots,M,
$$
The $\Delta_i$ matrices can be decomposed and be represented by the product of a variance structure component and a correlation structure component,

$$
    \Delta_i = V_i C_i V_i, 
$$
where $V_i$ is a diagonal matrix with all diagonal elements being positive, and $C_i$ is a correlation matrix, i.e.\ a positive definite matrix with all diagonal elements equal to $1$.
 It holds that

$$
  \text{Var}(\epsilon_{ij}) = \Sigma = \sigma^2[V_i]_{jj}^2, \quad \text{cor}(\epsilon_{ij}), \epsilon_{ik}= [C_i]_{jk},
$$
so that $V_i$ describes the variance and $C_i$ describes the correlation of the within-subject errors $\epsilon_i$.
This decomposition is appealing both theoretically and computationally, as it allows to model and to estimate the two structures separately and to combine them in a flexible manner.
The `mmrm` package supports a wide range of correlation structures<!-- add link -->.












<!---
Potential additions:
* Likelihood 
* Estimation
* Correlation structures
* Missing values
* Further reading
-->

## References





